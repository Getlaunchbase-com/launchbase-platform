This file contains the 4-step patch to apply to server/routers.ts intakes.submit mutation:

STEP 1: Add [HIT] log at line 117 (right after `.mutation(async ({ input }) => {`)
INSERT AFTER LINE 116:
```
        console.error("[HIT] intakes.submit", {
          email: input?.email,
          ts: new Date().toISOString(),
        });
```

STEP 2: Add robust intakeId derivation after `const intake = await createIntake(input);` (around line 120)
REPLACE:
```
        const intake = await createIntake(input);
        console.log('[DEBUG] createIntake returned:', intake);
```

WITH:
```
        const intake = await createIntake(input);
        
        const intakeId =
          (intake as any)?.id ??
          (intake as any)?.intakeId ??
          (typeof (intake as any) === "number" ? (intake as any) : null);
        
        console.error("[Intake] createIntake() result", {
          intakeType: typeof intake,
          keys: intake && typeof intake === "object" ? Object.keys(intake as any) : null,
          intakeId,
        });
        
        if (!intakeId) {
          throw new Error("createIntake() did not return an intake id");
        }
```

STEP 3: Change Phase 1 gate from `if (intake?.id)` to `if (intakeId)` (around line 167)
AND update all references to use intakeId

STEP 4: Add export sanity checks for dynamic imports (around line 168-170)
REPLACE:
```
          const { runFieldGeneral } = await import("./ai/orchestration/runFieldGeneral");
          const { createRunPlan, createShipPacket } = await import("./db");
```

WITH:
```
          const fgMod = await import("./ai/orchestration/runFieldGeneral");
          const runFieldGeneral = (fgMod as any).runFieldGeneral ?? (fgMod as any).default;
          if (typeof runFieldGeneral !== "function") {
            throw new Error("runFieldGeneral export not found (named or default)");
          }
          
          const dbMod = await import("./db");
          const createRunPlan = (dbMod as any).createRunPlan;
          const createShipPacket = (dbMod as any).createShipPacket;
          
          if (typeof createRunPlan !== "function") throw new Error("createRunPlan export not found");
          if (typeof createShipPacket !== "function") throw new Error("createShipPacket export not found");
```
