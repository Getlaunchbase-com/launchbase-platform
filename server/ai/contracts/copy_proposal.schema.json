{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CopyProposal",
  "description": "AI-generated copy proposals with variants, confidence, and approval requirements",
  "type": "object",
  "required": ["schemaVersion", "variants", "requiresApproval", "confidence", "risks", "assumptions"],
  "additionalProperties": false,
  "properties": {
    "schemaVersion": {
      "type": "string",
      "const": "v1",
      "description": "Schema version for safe migrations"
    },
    "variants": {
      "type": "array",
      "description": "Up to 3 copy variants for the target key",
      "minItems": 1,
      "maxItems": 3,
      "items": {
        "type": "object",
        "required": ["targetKey", "value", "rationale", "confidence"],
        "additionalProperties": false,
        "properties": {
          "targetKey": {
            "type": "string",
            "description": "Whitelisted key being modified (exactly one per variant)",
            "enum": [
              "hero.headline",
              "hero.subheadline",
              "hero.cta",
              "trust.items",
              "services.items",
              "socialProof.reviews",
              "socialProof.outcomes",
              "socialProof.credentials"
            ]
          },
          "value": {
            "description": "Proposed value (string max 120 chars OR array of items OR socialProof object)",
            "oneOf": [
              {
                "type": "string",
                "maxLength": 120,
                "description": "For hero.headline, hero.subheadline, hero.cta (max 120 chars)"
              },
              {
                "type": "array",
                "description": "For trust.items, services.items (3-5 items)",
                "minItems": 3,
                "maxItems": 5,
                "items": {
                  "oneOf": [
                    {
                      "type": "string",
                      "maxLength": 120,
                      "description": "Trust item (max 120 chars)"
                    },
                    {
                      "type": "object",
                      "description": "Service item with name and line",
                      "required": ["name", "line"],
                      "additionalProperties": false,
                      "properties": {
                        "name": {
                          "type": "string",
                          "maxLength": 60
                        },
                        "line": {
                          "type": "string",
                          "maxLength": 120
                        }
                      }
                    }
                  ]
                }
              },
              {
                "type": "object",
                "description": "For socialProof - MUST be exactly ONE of: reviews, outcomes, or credentials",
                "oneOf": [
                  {
                    "type": "object",
                    "description": "Reviews only",
                    "required": ["reviews"],
                    "additionalProperties": false,
                    "properties": {
                      "reviews": {
                        "type": "array",
                        "minItems": 3,
                        "maxItems": 5,
                        "items": {
                          "type": "object",
                          "required": ["text", "author"],
                          "additionalProperties": false,
                          "properties": {
                            "text": {
                              "type": "string",
                              "maxLength": 240
                            },
                            "author": {
                              "type": "string",
                              "maxLength": 60
                            }
                          }
                        }
                      }
                    }
                  },
                  {
                    "type": "object",
                    "description": "Outcomes only",
                    "required": ["outcomes"],
                    "additionalProperties": false,
                    "properties": {
                      "outcomes": {
                        "type": "array",
                        "minItems": 3,
                        "maxItems": 5,
                        "items": {
                          "type": "object",
                          "required": ["metric", "label"],
                          "additionalProperties": false,
                          "properties": {
                            "metric": {
                              "type": "string",
                              "maxLength": 20
                            },
                            "label": {
                              "type": "string",
                              "maxLength": 120
                            }
                          }
                        }
                      }
                    }
                  },
                  {
                    "type": "object",
                    "description": "Credentials only",
                    "required": ["credentials"],
                    "additionalProperties": false,
                    "properties": {
                      "credentials": {
                        "type": "array",
                        "minItems": 3,
                        "maxItems": 5,
                        "items": {
                          "type": "string",
                          "maxLength": 120
                        }
                      }
                    }
                  }
                ]
              }
            ]
          },
          "rationale": {
            "type": "string",
            "maxLength": 200,
            "description": "Why this variant was chosen"
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Confidence score (0-1)"
          },
          "risks": {
            "type": "array",
            "description": "Potential risks with this variant",
            "items": {
              "type": "string",
              "maxLength": 120
            },
            "maxItems": 3
          }
        }
      }
    },
    "requiresApproval": {
      "type": "boolean",
      "const": true,
      "description": "Must always be true"
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Overall confidence in proposals"
    },
    "risks": {
      "type": "array",
      "description": "Overall risks across all variants",
      "items": {
        "type": "string",
        "maxLength": 120
      },
      "maxItems": 5
    },
    "assumptions": {
      "type": "array",
      "description": "Assumptions made during generation",
      "items": {
        "type": "string",
        "maxLength": 120
      },
      "maxItems": 5
    }
  }
}
